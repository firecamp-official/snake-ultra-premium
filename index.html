<!DOCTYPE html> 
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Snake Ã‰nervÃ© 6.0 â€“ ULTRA PREMIUM PRO MAX MOBILE</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap');
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    width: 100%;
    background: radial-gradient(circle at center, #000 40%, #111 100%);
    font-family: 'Orbitron', sans-serif;
    color: #fff;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  canvas {
    background: linear-gradient(135deg, #111 0%, #222 100%);
    box-shadow: 0 0 30px #0ff, 0 0 60px #f0f;
    border: 3px solid #0ff;
    border-radius: 12px;
    touch-action: none;
    margin-top: 10px;
  }
  #score {
    font-size: 24px;
    font-weight: bold;
    text-shadow: 0 0 10px #0ff, 0 0 20px #f0f;
    margin-top: 10px;
  }
  #startBtn {
    padding: 15px 30px;
    font-size: 22px;
    font-weight: bold;
    color: #000;
    background: linear-gradient(45deg, #0ff, #f0f);
    border: 3px solid #fff;
    border-radius: 12px;
    cursor: pointer;
    margin: 10px;
    box-shadow: 0 0 10px #0ff, 0 0 20px #f0f;
  }
  #controls {
    position: absolute;
    bottom: 10px;
    display: flex;
    justify-content: center;
    gap: 10px;
    width: 100%;
  }
  .powerBtn {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    border: 3px solid #fff;
    font-size: 18px;
    font-weight: bold;
    color: #000;
    background: linear-gradient(45deg,#0ff,#f0f);
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 0 10px #0ff,0 0 20px #f0f;
    position: relative;
    overflow: hidden;
  }
  .cooldownOverlay {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.6);
    border-radius: 50%;
    transform-origin: bottom;
    transform: scaleY(0);
    transition: transform linear;
  }
  #gameOverPanel {
    position: absolute;
    top: 40%;
    background: rgba(0,0,0,0.9);
    border: 2px solid #0ff;
    padding: 20px;
    border-radius: 12px;
    display: none;
    text-align: center;
    box-shadow: 0 0 20px #f0f;
  }
</style>
</head>
<body>
<div id="score">Score: 0</div>
<button id="startBtn">START</button>
<canvas id="game"></canvas>

<!-- Boutons pouvoirs -->
<div id="controls">
  <div class="powerBtn" id="btnExplosion">E<div class="cooldownOverlay"></div></div>
  <div class="powerBtn" id="btnMagnet">A<div class="cooldownOverlay"></div></div>
  <div class="powerBtn" id="btnDash">D<div class="cooldownOverlay"></div></div>
  <div class="powerBtn" id="btnInvis">I<div class="cooldownOverlay"></div></div>
</div>

<div id="gameOverPanel">
  <h2>ðŸ’€ GAME OVER</h2>
  <p id="finalScore"></p>
  <button id="restartBtn">Rejouer</button>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const startBtn = document.getElementById("startBtn");
const gameOverPanel = document.getElementById("gameOverPanel");
const finalScore = document.getElementById("finalScore");
const restartBtn = document.getElementById("restartBtn");

let grid = 20;
let snake, dx, dy, fruit, shields, score, speed, gameOver, shield, invincible, boost, invisible;
let lasers, monsters, powers;
let shakeTime = 0;

let direction = "RIGHT";
let nextDirection = "RIGHT";

// Resize canvas
function resizeCanvas() {
  canvas.width = window.innerWidth * 0.95;
  canvas.height = window.innerHeight * 0.6;
}
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

// Init
function initGame() {
  snake = [{x:10,y:10}];
  dx=1; dy=0;
  direction="RIGHT"; nextDirection="RIGHT";
  fruit=randomFruit();
  shields=[];
  score=0;
  speed=180;
  gameOver=false;
  shield=true;
  invincible=false;
  boost=false;
  invisible=false;
  lasers=[];
  monsters=[];
  powers={
    explosion:{ready:true,cooldown:8000},
    magnet:{ready:true,cooldown:6000},
    dash:{ready:true,cooldown:4000},
    invisibility:{ready:true,cooldown:9000}
  };
  document.getElementById("score").innerText="Score: 0";
  startBtn.style.display="none";
  gameOverPanel.style.display="none";
  scheduleNextLaser();
  gameLoop();
}

// === CONTROLES ===
// Clavier
document.addEventListener("keydown", (e) => {
  if (e.key === "ArrowUp" && direction !== "DOWN") nextDirection = "UP";
  if (e.key === "ArrowDown" && direction !== "UP") nextDirection = "DOWN";
  if (e.key === "ArrowLeft" && direction !== "RIGHT") nextDirection = "LEFT";
  if (e.key === "ArrowRight" && direction !== "LEFT") nextDirection = "RIGHT";
});

// Swipe tactile
let touchStartX=0, touchStartY=0, touchEndX=0, touchEndY=0;
document.addEventListener("touchstart", (e) => {
  touchStartX = e.touches[0].clientX;
  touchStartY = e.touches[0].clientY;
});
document.addEventListener("touchend", (e) => {
  touchEndX = e.changedTouches[0].clientX;
  touchEndY = e.changedTouches[0].clientY;
  let dxSwipe = touchEndX - touchStartX;
  let dySwipe = touchEndY - touchStartY;
  if (Math.abs(dxSwipe) > Math.abs(dySwipe)) {
    if (dxSwipe > 30 && direction !== "LEFT") nextDirection = "RIGHT";
    if (dxSwipe < -30 && direction !== "RIGHT") nextDirection = "LEFT";
  } else {
    if (dySwipe > 30 && direction !== "UP") nextDirection = "DOWN";
    if (dySwipe < -30 && direction !== "DOWN") nextDirection = "UP";
  }
});

// === GAME LOOP ===
function gameLoop(){
  if(gameOver){ 
    finalScore.innerText = "Score final : "+score;
    gameOverPanel.style.display="block";
    return; 
  }

  direction = nextDirection;
  if(direction==="UP"){dx=0;dy=-1;}
  if(direction==="DOWN"){dx=0;dy=1;}
  if(direction==="LEFT"){dx=-1;dy=0;}
  if(direction==="RIGHT"){dx=1;dy=0;}

  updateLasers();
  updateMonsters();
  update();
  drawBackgroundGrid();
  draw();
  drawLasers();
  drawMonsters();
  drawShields();
  applyShake();
  setTimeout(gameLoop,speed);
}

// === UPDATE ===
function update(){
  let head={x:snake[0].x+dx,y:snake[0].y+dy};
  if(head.x<0||head.x>=canvas.width/grid||head.y<0||head.y>=canvas.height/grid){
    if(shield){shield=false; setInvincible(2000);} else{gameOver=true; return;}
  }
  for(let s of snake){
    if(s.x===head.x&&s.y===head.y){
      if(shield){shield=false; setInvincible(2000);} else{gameOver=true; return;}
    }
  }
  snake.unshift(head);
  if(head.x===fruit.x && head.y===fruit.y){
    score++; document.getElementById("score").innerText="Score: "+score;
    fruit=randomFruit();
    let oldSpeed=speed; speed=Math.max(60,speed-10);
    boost=true; setTimeout(()=>{speed=oldSpeed; boost=false;},1500);
    spawnMonster();
    if(shields.length<3 && Math.random()<0.3) spawnShield();
  }
  for(let i=shields.length-1;i>=0;i--){
    let s=shields[i];
    if(head.x===s.x&&head.y===s.y){ shield=true; shields.splice(i,1);}
  }
  snake.pop();
}

// === MONSTRES ===
function spawnMonster(){
  let x=Math.floor(Math.random()*(canvas.width/grid)),
      y=Math.floor(Math.random()*(canvas.height/grid));
  let type=["fast","slow","zigzag"][Math.floor(Math.random()*3)];
  let color=type==='fast'?'#f0f':type==='slow'?'#f90':'#0ff';
  let speedM=type==='fast'?2.5:type==='slow'?1.5:2;
  monsters.push({x,y,type,color,speed:speedM,dirX:1,dirY:1,life:4000});
}
function updateMonsters(){
  for(let i=monsters.length-1;i>=0;i--){
    let m=monsters[i];
    let hx=snake[0].x, hy=snake[0].y;
    if(m.type==='zigzag'){
      m.x+=m.speed*m.dirX; m.y+=m.speed*m.dirY;
      if(m.x<=0||m.x>=canvas.width/grid)m.dirX*=-1;
      if(m.y<=0||m.y>=canvas.height/grid)m.dirY*=-1;
    } else {
      if(m.x<hx)m.x+=m.speed; else if(m.x>hx)m.x-=m.speed;
      if(m.y<hy)m.y+=m.speed; else if(m.y>hy)m.y-=m.speed;
    }
    if(Math.floor(m.x)===hx&&Math.floor(m.y)===hy&&!invincible){
      if(shield){shield=false; setInvincible(2000);} else gameOver=true;
      monsters.splice(i,1);
    }
    m.life-=speed; if(m.life<=0)monsters.splice(i,1);
  }
}
function drawMonsters(){
  for(let m of monsters){
    ctx.shadowColor=m.color; ctx.fillStyle=m.color;
    ctx.beginPath(); ctx.arc(Math.floor(m.x)*grid+grid/2,Math.floor(m.y)*grid+grid/2,grid/2-3,0,Math.PI*2);
    ctx.fill();
  }
}

// === Pouvoirs tactiles ===
function triggerPower(type){
  if(!powers[type].ready) return;
  powers[type].ready=false;
  const btn=document.getElementById("btn"+type.charAt(0).toUpperCase()+type.slice(1));
  const overlay=btn.querySelector(".cooldownOverlay");
  overlay.style.transform="scaleY(1)";
  overlay.style.transitionDuration=powers[type].cooldown+"ms";
  setTimeout(()=>{powers[type].ready=true; overlay.style.transform="scaleY(0)";},powers[type].cooldown);

  if(type==="explosion"){ monsters=[]; flashScreen("#ff0"); }
  if(type==="magnet"){ fruit.x=snake[0].x; fruit.y=snake[0].y; flashScreen("#0ff"); }
  if(type==="dash"){ for(let i=0;i<6;i++){ snake.unshift({x:snake[0].x+dx,y:snake[0].y+dy}); snake.pop();} flashScreen("#f0f"); }
  if(type==="invisibility"){ invisible=true; setInvincible(4000); flashScreen("#888"); setTimeout(()=>{invisible=false;},4000); }
}

// === Divers ===
function setInvincible(d){ invincible=true; setTimeout(()=>invincible=false,d); }
function drawBackgroundGrid(){ ctx.fillStyle="#111"; ctx.fillRect(0,0,canvas.width,canvas.height); }
function draw(){
  ctx.shadowBlur=20;
  ctx.shadowColor=boost?"#ff0":invincible?"#0f0":"#f00";
  ctx.fillStyle=invisible?"rgba(255,255,255,0.2)":(shield?"#0f0":"#f44");
  for(let s of snake) ctx.fillRect(s.x*grid,s.y*grid,grid-2,grid-2);
  ctx.shadowColor="#ff0"; ctx.fillStyle="#ff0";
  ctx.beginPath(); ctx.arc(fruit.x*grid+grid/2,fruit.y*grid+grid/2,grid/2-2,0,Math.PI*2); ctx.fill();
}
function randomFruit(){ return {x:Math.floor(Math.random()*(canvas.width/grid)),y:Math.floor(Math.random()*(canvas.height/grid))};}
function flashScreen(color){ canvas.style.boxShadow=`0 0 40px ${color},0 0 80px ${color}`; setTimeout(()=>canvas.style.boxShadow="0 0 30px #0ff,0 0 60px #f0f",200);}
function spawnShield(){ let x=Math.floor(Math.random()*(canvas.width/grid)), y=Math.floor(Math.random()*(canvas.height/grid)); shields.push({x,y,timer:5000}); }
function drawShields(){ for(let i=shields.length-1;i>=0;i--){ let s=shields[i]; ctx.shadowColor="#0ff"; ctx.fillStyle=(Math.floor(Date.now()/200)%2===0)?"#0ff":"#08f"; ctx.beginPath(); ctx.arc(s.x*grid+grid/2,s.y*grid+grid/2,grid/2-3,0,Math.PI*2); ctx.fill(); s.timer-=speed; if(s.timer<=0)shields.splice(i,1);} }
function spawnLaser(){ let orientation=Math.random()<0.5?'h':'v'; let pos=orientation==='h'?Math.floor(Math.random()*(canvas.height/grid)):Math.floor(Math.random()*(canvas.width/grid)); lasers.push({orientation,pos,warning:true,timer:0});}
function scheduleNextLaser(){ let freq=Math.max(500,3000-score*50); setTimeout(()=>{spawnLaser(); scheduleNextLaser();},freq);}
function updateLasers(){ for(let i=lasers.length-1;i>=0;i--){ let l=lasers[i]; l.timer+=speed; if(l.warning&&l.timer>=800){l.warning=false;l.timer=0; shakeScreen(200);} let hx=snake[0].x,hy=snake[0].y; if(!l.warning){ if((l.orientation==='h'&&hy===l.pos)||(l.orientation==='v'&&hx===l.pos)){ if(!invincible){ if(shield){shield=false; setInvincible(2000);} else gameOver=true;}}} if(!l.warning&&l.timer>200)lasers.splice(i,1);} }
function drawLasers(){ for(let l of lasers){ ctx.shadowColor=l.warning?"#f00":"#ff0"; ctx.fillStyle=l.warning?"rgba(255,0,0,0.4)":"#ff0"; if(l.orientation==='h') ctx.fillRect(0,l.pos*grid,canvas.width,4); else ctx.fillRect(l.pos*grid,0,4,canvas.height);} }
function shakeScreen(d){ shakeTime=d; }
function applyShake(){ if(shakeTime>0){ let dx=Math.random()*8-4,dy=Math.random()*8-4; canvas.style.transform=`translate(${dx}px,${dy}px)`; shakeTime-=speed;} else canvas.style.transform=`translate(0,0)`; }

// === EVENTS ===
document.getElementById("btnExplosion").onclick=()=>triggerPower("explosion");
document.getElementById("btnMagnet").onclick=()=>triggerPower("magnet");
document.getElementById("btnDash").onclick=()=>triggerPower("dash");
document.getElementById("btnInvis").onclick=()=>triggerPower("invisibility");
startBtn.addEventListener("click",initGame);
restartBtn.addEventListener("click",initGame);
</script>
</body>
</html>
