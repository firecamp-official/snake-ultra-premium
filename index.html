<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Snake Ã‰nervÃ© 5.0 â€“ ULTRA PREMIUM PRO MAX</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap');
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    background: radial-gradient(circle at center, #000 40%, #111 100%);
    font-family: 'Orbitron', sans-serif;
    color: #fff;
    overflow: hidden;
    flex-direction: column;
  }
  canvas {
    background: linear-gradient(135deg, #111 0%, #222 100%);
    box-shadow: 0 0 30px #0ff, 0 0 60px #f0f;
    border: 3px solid #0ff;
    border-radius: 12px;
    touch-action: none;
  }
  #score {
    position: absolute;
    top: 15px;
    font-size: 26px;
    font-weight: bold;
    text-shadow: 0 0 10px #0ff, 0 0 20px #f0f;
    letter-spacing: 2px;
  }
  #info {
    position: absolute;
    bottom: 15px;
    font-size: 14px;
    color: #ccc;
    text-shadow: 0 0 6px #0ff;
  }
  #startBtn {
    padding: 15px 30px;
    font-size: 22px;
    font-weight: bold;
    color: #000;
    background: linear-gradient(45deg, #0ff, #f0f);
    border: 3px solid #fff;
    border-radius: 12px;
    cursor: pointer;
    margin-bottom: 20px;
    box-shadow: 0 0 10px #0ff, 0 0 20px #f0f;
    transition: transform 0.1s, box-shadow 0.2s;
  }
  #startBtn:active {
    transform: scale(0.95);
    box-shadow: 0 0 5px #0ff, 0 0 10px #f0f;
  }

  /* Joystick */
  #joystick {
    position: absolute;
    bottom: 70px;
    left: 50%;
    transform: translateX(-50%);
    width: 120px;
    height: 120px;
    background: rgba(255,255,255,0.1);
    border: 2px solid #0ff;
    border-radius: 50%;
    touch-action: none;
  }
  #stick {
    position: absolute;
    width: 60px;
    height: 60px;
    background: #0ff;
    border-radius: 50%;
    top: 30px;
    left: 30px;
    touch-action: none;
  }
</style>
</head>
<body>
<div id="score">Score: 0</div>
<div id="info">E: Explosion | A: Aimant | D: Dash | I: InvisibilitÃ©</div>
<button id="startBtn">START</button>
<canvas id="game"></canvas>
<div id="joystick"><div id="stick"></div></div>
<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const startBtn = document.getElementById("startBtn");
const joystick = document.getElementById("joystick");
const stick = document.getElementById("stick");

let grid = 20;
let snake, dx, dy, fruit, shields, score, speed, gameOver, shield, invincible, boost, invisible;
let lasers, monsters, powers;
let shakeTime = 0;

// Adapt canvas to mobile screen
function resizeCanvas() {
  canvas.width = window.innerWidth * 0.95;
  canvas.height = window.innerHeight * 0.7;
}
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

// --- INIT GAME ---
function initGame() {
  snake = [{x:10,y:10}];
  dx = 1; dy = 0;
  fruit = randomFruit();
  shields = [];
  score = 0;
  speed = 200;
  gameOver = false;
  shield = true;
  invincible = false;
  boost = false;
  invisible = false;
  lasers = [];
  monsters = [];
  powers = {
    explosion:{ready:true,cooldown:10000},
    magnet:{ready:true,cooldown:8000},
    dash:{ready:true,cooldown:5000},
    invisibility:{ready:true,cooldown:12000}
  };
  document.getElementById("score").innerText = "Score: 0";
  startBtn.style.display = "none";
  scheduleNextLaser();
  gameLoop();
}

// --- INPUT ---
let touchStartX=0, touchStartY=0;
function handleKey(e){
  if(!snake) return;
  if(e.key==="ArrowUp" && dy===0){ dx=0; dy=-1;}
  if(e.key==="ArrowDown" && dy===0){ dx=0; dy=1;}
  if(e.key==="ArrowLeft" && dx===0){ dx=-1; dy=0;}
  if(e.key==="ArrowRight" && dx===0){ dx=1; dy=0;}
  if(e.key.toLowerCase()==="e" && powers.explosion.ready){ powers.explosion.ready=false; monsters=[]; flashScreen("#ff0"); setTimeout(()=>powers.explosion.ready=true,powers.explosion.cooldown);}
  if(e.key.toLowerCase()==="a" && powers.magnet.ready){ powers.magnet.ready=false; fruit.x=snake[0].x; fruit.y=snake[0].y; flashScreen("#0ff"); setTimeout(()=>powers.magnet.ready=true,powers.magnet.cooldown);}
  if(e.key.toLowerCase()==="d" && powers.dash.ready){ powers.dash.ready=false; for(let i=0;i<6;i++){ snake.unshift({x:snake[0].x+dx,y:snake[0].y+dy}); snake.pop();} flashScreen("#f0f"); setTimeout(()=>powers.dash.ready=true,powers.dash.cooldown);}
  if(e.key.toLowerCase()==="i" && powers.invisibility.ready){ powers.invisibility.ready=false; invisible=true; setInvincible(5000); flashScreen("#888"); setTimeout(()=>{invisible=false;},5000); setTimeout(()=>powers.invisibility.ready=true,powers.invisibility.cooldown);}
}
document.addEventListener("keydown",handleKey);

// --- TOUCH CONTROLS ---
canvas.addEventListener("touchstart",(e)=>{ touchStartX=e.touches[0].clientX; touchStartY=e.touches[0].clientY; }, {passive:true});
canvas.addEventListener("touchend",(e)=>{
  let dxTouch = e.changedTouches[0].clientX - touchStartX;
  let dyTouch = e.changedTouches[0].clientY - touchStartY;
  if(Math.abs(dxTouch)>Math.abs(dyTouch)){ dx=dxTouch>0?1:-1; dy=0;} else { dx=0; dy=dyTouch>0?1:-1; }
});

// Joystick
let stickCenter = {x:60,y:60};
let dragging=false;
stick.addEventListener("touchstart",(e)=>{dragging=true; e.preventDefault();});
stick.addEventListener("touchmove",(e)=>{
  if(!dragging) return;
  let touch = e.touches[0];
  let rect = joystick.getBoundingClientRect();
  let x = touch.clientX - rect.left;
  let y = touch.clientY - rect.top;
  let deltaX = x-stickCenter.x;
  let deltaY = y-stickCenter.y;
  let maxDist = 50;
  let dist = Math.min(Math.sqrt(deltaX*deltaX+deltaY*deltaY), maxDist);
  let angle = Math.atan2(deltaY, deltaX);
  let newX = stickCenter.x + dist*Math.cos(angle);
  let newY = stickCenter.y + dist*Math.sin(angle);
  stick.style.left = (newX-30)+"px";
  stick.style.top = (newY-30)+"px";
  if(Math.abs(deltaX)>Math.abs(deltaY)){ dx=deltaX>0?1:-1; dy=0;} else { dx=0; dy=deltaY>0?1:-1; }
  e.preventDefault();
});
stick.addEventListener("touchend",(e)=>{ dragging=false; stick.style.left="30px"; stick.style.top="30px"; });

// --- INVINCIBILITY ---
function setInvincible(duration){ invincible=true; setTimeout(()=>invincible=false,duration); }

// --- GAME LOOP ---
function gameLoop(){
  if(gameOver){ alert("ðŸ’€ GAME OVER â€“ Score: "+score); startBtn.style.display="block"; return; }
  updateLasers();
  updateMonsters();
  update();
  drawBackgroundGrid();
  draw();
  drawLasers();
  drawMonsters();
  drawShields();
  drawCooldowns();
  applyShake();
  setTimeout(gameLoop,speed);
}

// --- UPDATE ---
function update(){
  let head={x:snake[0].x+dx,y:snake[0].y+dy};
  if(head.x<0||head.x>=canvas.width/grid||head.y<0||head.y>=canvas.height/grid){ if(shield){shield=false; setInvincible(2000);} else{gameOver=true; return;}}
  for(let s of snake){ if(s.x===head.x&&s.y===head.y){ if(shield){shield=false; setInvincible(2000);} else {gameOver=true; return;}}}
  snake.unshift(head);
  if(head.x===fruit.x && head.y===fruit.y){
    score++; document.getElementById("score").innerText="Score: "+score;
    fruit=randomFruit();
    let oldSpeed=speed; speed=Math.max(50,speed-50); boost=true;
    setTimeout(()=>{speed=oldSpeed; boost=false;},2000);
    spawnMonster();
    if(shields.length<3 && Math.random()<0.3) spawnShield();
  }
  for(let i=shields.length-1;i>=0;i--){ let s=shields[i]; if(head.x===s.x&&head.y===s.y){ shield=true; shields.splice(i,1);} }
  snake.pop();
}

// --- DRAW FUNCTIONS ---
function drawBackgroundGrid(){ ctx.fillStyle="#111"; ctx.fillRect(0,0,canvas.width,canvas.height); ctx.strokeStyle="rgba(0,255,255,0.1)"; for(let x=0;x<canvas.width;x+=grid){ ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,canvas.height); ctx.stroke();} for(let y=0;y<canvas.height;y+=grid){ ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(canvas.width,y); ctx.stroke();}}
function draw(){ ctx.shadowBlur=20; ctx.shadowColor=boost?"#ff0":invincible?"#0f0":"#f00"; ctx.fillStyle=invisible?"rgba(255,255,255,0.2)":(shield?"#0f0":"#f44"); for(let s of snake) ctx.fillRect(s.x*grid,s.y*grid,grid-2,grid-2); ctx.shadowColor="#ff0"; ctx.fillStyle="#ff0"; ctx.beginPath(); ctx.arc(fruit.x*grid+grid/2,fruit.y*grid+grid/2,grid/2-2,0,Math.PI*2); ctx.fill();}
function flashScreen(color){ canvas.style.boxShadow=`0 0 40px ${color}, 0 0 80px ${color}`; setTimeout(()=>canvas.style.boxShadow="0 0 30px #0ff, 0 0 60px #f0f",200);}
function randomFruit(){ return {x:Math.floor(Math.random()*(canvas.width/grid)),y:Math.floor(Math.random()*(canvas.height/grid))};}

function spawnShield(){ let x=Math.floor(Math.random()*(canvas.width/grid)), y=Math.floor(Math.random()*(canvas.height/grid)); shields.push({x,y,timer:5000}); }
function drawShields(){ for(let i=shields.length-1;i>=0;i--){ let s=shields[i]; ctx.shadowColor="#0ff"; ctx.fillStyle=(Math.floor(Date.now()/200)%2===0)?"#0ff":"#08f"; ctx.beginPath(); ctx.arc(s.x*grid+grid/2,s.y*grid+grid/2,grid/2-3,0,Math.PI*2); ctx.fill(); s.timer-=speed; if(s.timer<=0) shields.splice(i,1);} }

function spawnLaser(){ let orientation=Math.random()<0.5?'h':'v'; let pos=orientation==='h'?Math.floor(Math.random()*(canvas.height/grid)):Math.floor(Math.random()*(canvas.width/grid)); lasers.push({orientation,pos,warning:true,timer:0});}
function scheduleNextLaser(){ let freq=Math.max(500,3000-score*50); setTimeout(()=>{spawnLaser(); scheduleNextLaser();}, freq);}
function updateLasers(){ for(let i=lasers.length-1;i>=0;i--){ let l=lasers[i]; l.timer+=speed; if(l.warning&&l.timer>=1000){l.warning=false;l.timer=0; shakeScreen(200);} let hx=snake[0].x, hy=snake[0].y; if(!l.warning){ if((l.orientation==='h'&&hy===l.pos)||(l.orientation==='v'&&hx===l.pos)){ if(!invincible){ if(shield){shield=false; setInvincible(2000);} else gameOver=true;}}} if(!l.warning&&l.timer>200) lasers.splice(i,1);} }
function drawLasers(){ for(let l of lasers){ ctx.shadowColor=l.warning?"#f00":"#ff0"; ctx.fillStyle=l.warning?"rgba(255,0,0,0.4)":"#ff0"; if(l.orientation==='h') ctx.fillRect(0,l.pos*grid,canvas.width,4); else ctx.fillRect(l.pos*grid,0,4,canvas.height); }}

function spawnMonster(){ let x=Math.floor(Math.random()*(canvas.width/grid)), y=Math.floor(Math.random()*(canvas.height/grid)); let type=["fast","slow","zigzag"][Math.floor(Math.random()*3)]; let color=type==='fast'?'#f0f':type==='slow'?'#f90':'#0ff'; let speedM=type==='fast'?2:type==='slow'?1:1.5; monsters.push({x,y,type,color,speed:speedM,dirX:1,dirY:1,life:5000});}
function updateMonsters(){ for(let i=monsters.length-1;i>=0;i--){ let m=monsters[i]; let hx=snake[0].x, hy=snake[0].y; if(m.type==='zigzag'){ m.x+=m.speed*m.dirX; m.y+=m.speed*m.dirY; if(m.x<=0||m.x>=canvas.width/grid)m.dirX*=-1; if(m.y<=0||m.y>=canvas.height/grid)m.dirY*=-1;} else{ if(m.x<hx)m.x+=m.speed; else if(m.x>hx)m.x-=m.speed; if(m.y<hy)m.y+=m.speed; else if(m.y>hy)m.y-=m.speed;} if(Math.floor(m.x)===hx&&Math.floor(m.y)===hy&&!invincible){ if(shield){shield=false; setInvincible(2000);} else gameOver=true; monsters.splice(i,1);} m.life-=speed; if(m.life<=0) monsters.splice(i,1);}}
function drawMonsters(){ for(let m of monsters){ ctx.shadowColor=m.color; ctx.fillStyle=m.color; ctx.beginPath(); ctx.arc(Math.floor(m.x)*grid+grid/2,Math.floor(m.y)*grid+grid/2,grid/2-3,0,Math.PI*2); ctx.fill();}}

function shakeScreen(duration){ shakeTime=duration;}
function applyShake(){ if(shakeTime>0){ let dx=Math.random()*10-5; let dy=Math.random()*10-5; canvas.style.transform=`translate(${dx}px,${dy}px)`; shakeTime-=speed;} else canvas.style.transform=`translate(0,0)`;}

function drawCooldowns(){ let x=10,y=canvas.height-20; ctx.font="bold 12px Orbitron"; for(let key in powers){ctx.fillStyle=powers[key].ready?"#0f0":"#555"; ctx.fillRect(x,y,40,8); ctx.fillStyle="#fff"; ctx.fillText(key[0].toUpperCase(),x+12,y); x+=50;}}

startBtn.addEventListener("click",initGame);
</script>
</body>
</html>
